<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<style>
			iframe {
				width: 0%;
				height: 0%;
				overflow-clip-margin: unset !important;
				overflow: visible !important;
				border-width: 0px;
				border-style: inset;
				border-color: initial;
				border-image: initial;
			}

			.iframe {
				width: 100%;
				height: 100%;
			}

			html {
				height: 100%;
			}

			body {
				height: 100%;
				margin: 0px;
				overflow: hidden;
			}
		</style>
		<script type="module">
			window.addEventListener("contextmenu", (e) => e.preventDefault(), false);
			const appWindow = window.__TAURI__.window;
			appWindow.getCurrent().listen("tauri://close-requested", async function(event) {

				console.log('close-requested', event);
				const confirmed = await window.__TAURI__.dialog.confirm('你确认要关闭此应用吗？');
				if (!confirmed) {
					console.log('Q result - false', confirmed);
				} else {
					appWindow.getCurrent().close();
					console.log('Q result - true', confirmed);
					fetch('http://127.0.0.1:8000/close').then(response => {
						if (response.ok) {
							return response.json();
						} else {
							throw new Error(response.statusText);
						}
					})
				}
			});
		</script>
		<script src="./connect.js">
		</script>
	</head>
	<body style="background-color: aquamarine;">
		<script>
			document.addEventListener("DOMContentLoaded", () => {
				let frame = document.querySelector('iframe');
				// 必须设置随机参数以免无法刷新，而且要避免重定向
				frame.src = `http://127.0.0.1:8000/main/main.html?random=${Math.random()}`;
			}, false);
			// 阻止不合时宜的右键菜单
			// window.addEventListener("contextmenu", (e) => e.preventDefault(), false);


		</script>
		<iframe onload="reloadFrame()"></iframe>

	</body>
</html>